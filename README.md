# GraphDB - Документация

## Оглавление
1. [Быстрый старт](#быстрый-старт)
2. [Основные команды](#основные-команды)
3. [Работа с индексами](#работа-с-индексами)
4. [Транзакции](#транзакции)
5. [Оптимизация производительности](#оптимизация-производительности)
6. [Примеры использования](#примеры-использования)
7. [Области применения](#области-применения)
8. [Ограничения](#ограничения)
9. [Часто задаваемые вопросы](#часто-задаваемые-вопросы)

---

## Быстрый старт

### Установка
```python
pip install graphdb-python  # Или добавьте файл класса GraphDB в свой проект
```

### Минимальный пример
```python
from graphdb import GraphDB

# Инициализация базы данных
db = GraphDB("my_database.db")

# Создание узлов
db.insert("user1", {"name": "Alice", "age": 25})
db.insert("user2", {"name": "Bob", "age": 30})

# Создание связи
db.add_relationship("user1", "user2", "friends")

# Поиск
results = db.select(name="Alice")
print(results)  # [{'id': 'user1', 'name': 'Alice', 'age': 25}]
```

---

## Основные команды

### Управление узлами
| Команда | Описание | Пример |
|---------|----------|--------|
| `insert` | Добавление узла | `db.insert("id", {"prop": "value"})` |
| `update` | Обновление узла | `db.update("id", {"new_prop": 123})` |
| `delete` | Удаление узла | `db.delete("id")` |
| `select` | Поиск узлов | `db.select(age=25)` |
| `bulk_insert` | Массовая вставка | `db.bulk_insert({"id1": {...}, "id2": {...}})` |

### Работа с отношениями
| Команда | Описание | Пример |
|---------|----------|--------|
| `add_relationship` | Добавить связь | `db.add_relationship("from", "to", "type")` |
| `find_relationships` | Найти связи | `db.find_relationships(from_node="user1")` |
| `bulk_add_relationships` | Массовое добавление связей | `db.bulk_add_relationships([rel1, rel2])` |

### Администрирование
| Команда | Описание | Пример |
|---------|----------|--------|
| `save` | Сохранить базу | `db.save()` |
| `load` | Загрузить базу | `db.load()` |
| `print_stats` | Показать статистику | `db.print_stats()` |

---

## Работа с индексами

### Создание индекса
```python
# Вручную создать индекс для свойства "age"
db.create_index("age")
```

### Автоматическая индексация
Индексы автоматически создаются при:
- Вставке новых узлов
- Обновлении свойств

### Оптимизация поиска
```python
# Поиск с использованием индекса (быстро)
db.select(age=30)

# Поиск без индекса (медленнее)
db.select(custom_prop="value")
```

---

## Транзакции

### Базовое использование
```python
with db.transaction():
    db.insert("temp1", {"data": 1})
    db.insert("temp2", {"data": 2})
    # Если произойдет ошибка - все изменения откатятся
```

### Пример с откатом
```python
try:
    with db.transaction():
        db.insert("temp", {"data": 1})
        raise Exception("Ошибка!")
except:
    print("Узел temp существует?", "temp" in db.nodes)  # False
```

---

## Оптимизация производительности

### Рекомендации
1. **Пакетные операции**:
   ```python
   # Вместо:
   for i in range(1000):
       db.insert(f"node_{i}", {...})
   
   # Используйте:
   db.bulk_insert({f"node_{i}": {...} for i in range(1000)})
   ```

2. **Индексы**:
   - Создавайте индексы для часто используемых полей
   - Удаляйте неиспользуемые индексы

3. **Кэширование**:
   ```python
   # Для часто повторяющихся запросов
   @lru_cache
   def get_users_by_age(age):
       return db.select(age=age)
   ```

---

## Примеры использования

### Социальная сеть
```python
# Создание пользователей
db.insert("alice", {"name": "Alice", "friends": []})
db.insert("bob", {"name": "Bob", "friends": []})

# Добавление друзей
db.add_relationship("alice", "bob", "friend")

# Рекомендации друзей
friends_of_friends = db.find_relationships(
    from_node=db.find_relationships(from_node="alice")[0].to_node
)
```

### Рекомендательная система
```python
# Создание графа покупок
db.add_relationship("user1", "productA", "purchased")
db.add_relationship("user1", "productB", "purchased")

# Поиск рекомендаций
similar_users = db.select(purchased_products=["productA", "productB"])
```

---

## Области применения

1. **Социальные сети**:
   - Графы друзей
   - Рекомендации связей

2. **Рекомендательные системы**:
   - Анализ поведения пользователей
   - Поиск похожих товаров

3. **Знаниевые базы**:
   - Хранение взаимосвязей между понятиями
   - Семантический поиск

4. **Анализ данных**:
   - Выявление паттернов
   - Обнаружение сообществ

5. **Маршрутизация**:
   - Поиск кратчайших путей
   - Оптимизация доставки

---

## Ограничения

1. **Объем данных**:
   - Оптимально до 10 миллионов узлов
   - Для больших объемов требуется шардирование

2. **Производительность**:
   - Сложные запросы могут требовать оптимизации
   - Глубокие обходы графа (>5 уровней) медленные

3. **Память**:
   - Все данные хранятся в оперативной памяти
   - Требуется ~1KB памяти на узел

---

## Часто задаваемые вопросы

### Как сделать резервную копию?
```python
db.save()  # Создает файл с данными
```

### Как импортировать данные из JSON?
```python
import json
data = json.load(open("data.json"))
db.bulk_insert(data)
```

### Как найти все связи узла?
```python
relations = db.find_relationships(from_node="user1") + \
            db.find_relationships(to_node="user1")
```

### Как улучшить производительность поиска?
1. Создавайте индексы для часто используемых полей
2. Используйте пакетные операции
3. Кэшируйте результаты сложных запросов

---

## Заключение

GraphDB предоставляет простой, но мощный API для работы с графовыми данными. Для начала работы достаточно нескольких базовых команд, а встроенные механизмы индексации и транзакций позволяют строить надежные приложения.

Для более сложных сценариев используйте:
- Пакетные операции для массовых вставок
- Индексы для ускорения поиска
- Транзакции для обеспечения целостности данных

При возникновении вопросов обращайтесь к документации или пишите в issues проекта.
